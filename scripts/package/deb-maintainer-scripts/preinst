#!/bin/sh
# Copyright Manta Inc. All Rights Reserved.
# SPDX-License-Identifier: MIT

if [ "$1" = "upgrade" ]; then
    if systemctl is-active --quiet calamari.service; then
        systemctl stop calamari.service
    fi
    if systemctl is-active --quiet dolphin.service; then
        systemctl stop dolphin.service
    fi
    if systemctl is-active --quiet manta.service; then
        systemctl stop manta.service
    fi
fi

if ! getent group manta > /dev/null 2>&1; then
    addgroup --system manta
    echo "addgroup manta, result: $?"
fi

if ! getent passwd manta > /dev/null 2>&1; then
    adduser \
        --system \
        --home /var/lib/substrate \
        --disabled-password \
        --ingroup manta \
        manta
    echo "adduser manta, result: $?"
fi
